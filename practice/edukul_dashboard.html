<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edukul ERP Dashboard</title>
<style>
:root{
  --primary:#2563eb;
  --bg:#f4f6f9;
  --card:#fff;
  --text:#222;
  --accent:#0b76ef;
  --success:#16a34a;
  --warning:#f59e0b;
  --danger:#dc2626;
  --sidebar-width:220px;
}
*{box-sizing:border-box;}
body{margin:0;font-family:'Inter',Arial,sans-serif;background:var(--bg);color:var(--text);}
a{text-decoration:none;color:inherit;}
button{cursor:pointer;}
.sidebar{
  position:fixed;top:0;left:0;height:100%;width:var(--sidebar-width);
  background:var(--primary);display:flex;flex-direction:column;padding-top:20px;color:#fff;
}
.sidebar h2{text-align:center;margin-bottom:30px;font-size:20px;}
.sidebar a{padding:12px 20px;display:block;color:#fff;margin:2px 0;border-radius:6px;transition:0.2s;}
.sidebar a.active,.sidebar a:hover{background:rgba(255,255,255,0.2);}
.main-content{margin-left:var(--sidebar-width);padding:20px;}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
.topbar button{background:var(--danger);color:#fff;border:none;padding:8px 12px;border-radius:6px;}
.card{background:var(--card);padding:20px;border-radius:10px;margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,0.05);}
form input, form select, form textarea{width:100%;padding:8px;margin:6px 0;border:1px solid #ddd;border-radius:6px;}
form button{padding:10px 16px;background:var(--primary);border:none;color:#fff;border-radius:6px;margin-top:10px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:left;}
th{background:var(--primary);color:#fff;border-radius:6px;}
.section{display:none;transition:0.3s;}
@media(max-width:768px){.sidebar{width:60px;}.main-content{margin-left:60px;}.sidebar h2{display:none;}}
</style>
</head>
<body>

<div class="sidebar">
  <h2>Edukul ERP</h2>
  <a href="#" class="active" onclick="showSection('dashboard')">Dashboard</a>
  <a href="#" onclick="showSection('inquiries')">Inquiries</a>
  <a href="#" onclick="showSection('admissions')">Admissions</a>
  <a href="#" onclick="showSection('fee')">Fee</a>
  <a href="#" onclick="showSection('attendance')">Attendance</a>
  <a href="#" onclick="showSection('ptm')">PTM</a>
</div>

<div class="main-content">
  <div class="topbar">
    <div><strong>Role:</strong> Admin</div>
    <button onclick="logout()">Logout</button>
  </div>

  <div id="dashboard" class="section" style="display:block;">
    <div class="card">
      <h3>Welcome to Edukul ERP Dashboard</h3>
      <p>Select any module from the sidebar to manage data.</p>
    </div>
  </div>

  <!-- Inquiries -->
  <div id="inquiries" class="section">
    <div class="card">
      <h3>Add / Update Inquiry</h3>
      <form id="inquiryForm">
        <input type="hidden" id="inquiryId">
        <input type="text" id="studentName" placeholder="Student Name" required>
        <input type="text" id="contact" placeholder="Contact">
        <select id="inquiryType">
          <option value="Admission">Admission</option>
          <option value="Other">Other</option>
        </select>
        <input type="text" id="source" placeholder="Source">
        <input type="text" id="zone" placeholder="Zone">
        <button type="submit">Save Inquiry</button>
      </form>
    </div>
    <div class="card">
      <h3>Inquiry List</h3>
      <table>
        <thead>
          <tr><th>ID</th><th>Name</th><th>Contact</th><th>Type</th><th>Source</th><th>Zone</th><th>Status</th></tr>
        </thead>
        <tbody id="inquiryBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Admissions -->
  <div id="admissions" class="section">
    <div class="card">
      <h3>Add / Update Admission</h3>
      <form id="admissionForm">
        <input type="hidden" id="admissionId">
        <input type="text" id="admissionName" placeholder="Student Name">
        <input type="text" id="classAllocated" placeholder="Class">
        <input type="text" id="batch" placeholder="Batch">
        <input type="text" id="moduleName" placeholder="Module">
        <input type="text" id="admissionContact" placeholder="Parent Contact">
        <button type="submit">Save Admission</button>
      </form>
    </div>
    <div class="card">
      <h3>Admission List</h3>
      <table>
        <thead>
          <tr><th>ID</th><th>Name</th><th>Contact</th><th>Class</th><th>Batch</th><th>Module</th><th>Status</th></tr>
        </thead>
        <tbody id="admissionBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Fee -->
  <div id="fee" class="section">
    <div class="card">
      <h3>Add / Update Fee</h3>
      <form id="feeForm">
        <input type="hidden" id="feeId">
        <input type="text" id="feeStudentName" placeholder="Student Name">
        <input type="number" id="feeAmount" placeholder="Amount Paid">
        <input type="date" id="feeDate">
        <input type="text" id="feeMode" placeholder="Payment Mode">
        <input type="text" id="receiptNo" placeholder="Receipt No">
        <button type="submit">Save Fee</button>
      </form>
    </div>
    <div class="card">
      <h3>Fee List</h3>
      <table>
        <thead>
          <tr><th>ID</th><th>Name</th><th>Amount</th><th>Date</th><th>Mode</th><th>Receipt</th><th>Status</th></tr>
        </thead>
        <tbody id="feeBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Attendance -->
  <div id="attendance" class="section">
    <div class="card">
      <h3>Add / Update Attendance</h3>
      <form id="attendanceForm">
        <input type="hidden" id="attendanceId">
        <input type="date" id="attendanceDate">
        <input type="text" id="attendanceClass" placeholder="Class/Batch">
        <input type="text" id="attendanceAbsent" placeholder="Absent Students (comma separated)">
        <button type="submit">Save Attendance</button>
      </form>
    </div>
    <div class="card">
      <h3>Attendance List</h3>
      <table>
        <thead>
          <tr><th>ID</th><th>Date</th><th>Class</th><th>Absent Students</th></tr>
        </thead>
        <tbody id="attendanceBody"></tbody>
      </table>
    </div>
  </div>

  <!-- PTM -->
  <div id="ptm" class="section">
    <div class="card">
      <h3>Add / Update PTM</h3>
      <form id="ptmForm">
        <input type="hidden" id="ptmId">
        <input type="text" id="ptmStudentName" placeholder="Student Name">
        <input type="date" id="ptmDate">
        <input type="time" id="ptmTime">
        <textarea id="ptmFeedback" placeholder="Feedback"></textarea>
        <button type="submit">Save PTM</button>
      </form>
    </div>
    <div class="card">
      <h3>PTM List</h3>
      <table>
        <thead>
          <tr><th>ID</th><th>Student</th><th>Date</th><th>Time</th><th>Feedback</th><th>Status</th></tr>
        </thead>
        <tbody id="ptmBody"></tbody>
      </table>
    </div>
  </div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbx2g5LE-Tij7dk4z8_fDHOYBiw-nmuTqbH80ceq5HexhKPrNJ80KQgwPXwbE-WUWu4A/exec"; // replace with deployed Apps Script URL

function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
  document.querySelectorAll('.sidebar a').forEach(a=>a.classList.remove('active'));
  document.querySelector(`.sidebar a[onclick="showSection('${id}')"]`).classList.add('active');
}
function logout(){alert("Logging out...");}

// Unique ID generator
function generateId(){return 'ID'+Date.now();}

// Fetch JSON safely
async function fetchJSON(url){
  const res = await fetch(url);
  return res.json();
}
async function postData(action,payload){
  const res = await fetch(API_URL+'?action='+action,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(payload)
  });
  return res.json();
}

// ====== Load Tables ======
async function loadInquiries(){
  const data = await fetchJSON(API_URL+'?action=getInquiries');
  const tbody = document.getElementById('inquiryBody'); tbody.innerHTML='';
  (data||[]).forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.id}</td><td>${r.name}</td><td>${r.contact}</td><td>${r.type}</td><td>${r.source}</td><td>${r.zone}</td><td>${r.status||'Pending'}</td>`;
    tbody.appendChild(tr);
  });
}
async function loadAdmissions(){
  const data = await fetchJSON(API_URL+'?action=getAdmissions');
  const tbody = document.getElementById('admissionBody'); tbody.innerHTML='';
  (data||[]).forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.id}</td><td>${r.name}</td><td>${r.contact}</td><td>${r.class}</td><td>${r.batch}</td><td>${r.module}</td><td>${r.status||'Active'}</td>`;
    tbody.appendChild(tr);
  });
}
async function loadFee(){
  const data = await fetchJSON(API_URL+'?action=getFee');
  const tbody = document.getElementById('feeBody'); tbody.innerHTML='';
  (data||[]).forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.id}</td><td>${r.name}</td><td>${r.amount}</td><td>${r.date}</td><td>${r.mode}</td><td>${r.receipt}</td><td>${r.status||'Paid'}</td>`;
    tbody.appendChild(tr);
  });
}
async function loadAttendance(){
  const data = await fetchJSON(API_URL+'?action=getAttendance');
  const tbody = document.getElementById('attendanceBody'); tbody.innerHTML='';
  (data||[]).forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.id}</td><td>${r.date}</td><td>${r.class}</td><td>${r.absent}</td>`;
    tbody.appendChild(tr);
  });
}
async function loadPTM(){
  const data = await fetchJSON(API_URL+'?action=getPTM');
  const tbody = document.getElementById('ptmBody'); tbody.innerHTML='';
  (data||[]).forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${r.id}</td><td>${r.name}</td><td>${r.date}</td><td>${r.time}</td><td>${r.feedback}</td><td>${r.status||'Completed'}</td>`;
    tbody.appendChild(tr);
  });
}

// ====== Submit Handlers ======
document.getElementById('inquiryForm').onsubmit=async function(e){
  e.preventDefault();
  const payload={ id:generateId(), name:document.getElementById('studentName').value, contact:document.getElementById('contact').value, type:document.getElementById('inquiryType').value, source:document.getElementById('source').value, zone:document.getElementById('zone').value, status:'Pending' };
  await postData('addInquiry',payload);
  this.reset(); loadInquiries();
}

document.getElementById('admissionForm').onsubmit=async function(e){
  e.preventDefault();
  const payload={ id:generateId(), name:document.getElementById('admissionName').value, contact:document.getElementById('admissionContact').value, class:document.getElementById('classAllocated').value, batch:document.getElementById('batch').value, module:document.getElementById('moduleName').value, status:'Active' };
  await postData('addAdmission',payload);
  this.reset(); loadAdmissions();
}

document.getElementById('feeForm').onsubmit=async function(e){
  e.preventDefault();
  const payload={ id:generateId(), name:document.getElementById('feeStudentName').value, amount:document.getElementById('feeAmount').value, date:document.getElementById('feeDate').value, mode:document.getElementById('feeMode').value, receipt:document.getElementById('receiptNo').value, status:'Paid' };
  await postData('addFee',payload);
  this.reset(); loadFee();
}

document.getElementById('attendanceForm').onsubmit=async function(e){
  e.preventDefault();
  const payload={ id:generateId(), date:document.getElementById('attendanceDate').value, class:document.getElementById('attendanceClass').value, absent:document.getElementById('attendanceAbsent').value };
  await postData('addAttendance',payload);
  this.reset(); loadAttendance();
}

document.getElementById('ptmForm').onsubmit=async function(e){
  e.preventDefault();
  const payload={ id:generateId(), name:document.getElementById('ptmStudentName').value, date:document.getElementById('ptmDate').value, time:document.getElementById('ptmTime').value, feedback:document.getElementById('ptmFeedback').value, status:'Completed' };
  await postData('addPTM',payload);
  this.reset(); loadPTM();
}

// ====== Initial Load ======
loadInquiries(); loadAdmissions(); loadFee(); loadAttendance(); loadPTM();
</script>
</body>
</html>
